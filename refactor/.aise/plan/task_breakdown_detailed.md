# daloradius-python 重构任务分解（细化版）

本文件细化每个重构任务，明确输入、输出、要求，并为每个任务设计专业 prompt，便于 AI agent 自动执行。

---

## 1. 项目分析与规划
### 1.1 现有 PHP 代码结构梳理与功能清单整理
- 输入：`app/`, `operators/`, `users/` 目录下所有 PHP 文件
- 输出：功能清单（markdown），各模块说明，主要页面/接口列表
- 要求：全面覆盖所有业务模块，梳理页面与接口功能
- Prompt：
  > 请分析 daloradius 项目中 `app/`, `operators/`, `users/` 目录下所有 PHP 文件，输出详细的功能清单和模块说明，列出每个页面和接口的主要功能。

### 1.2 选择 Python 框架并确定技术栈
- 输入：功能清单、团队技术偏好、主流框架对比资料
- 输出：框架选型报告（markdown），技术栈列表
- 要求：结合项目需求、社区活跃度、扩展性等因素
- Prompt：
  > 根据 daloradius 功能清单和主流 Python Web 框架（Flask、FastAPI、Django）对比，输出推荐框架及技术栈，并说明理由。

### 1.3 设计重构后的项目目录结构
- 输入：框架选型报告、功能清单
- 输出：目录结构草案（markdown），目录说明
- 要求：结构清晰，便于扩展和维护
- Prompt：
  > 请根据选定的 Python 框架和 daloradius 功能清单，设计重构后的项目目录结构，并说明每个目录的用途。

---

## 2. 数据库设计与迁移
### 2.1 梳理现有数据库结构与表关系
- 输入：现有数据库 schema、相关 PHP 数据库操作代码
- 输出：数据库表结构说明（markdown），ER 图
- 要求：涵盖所有表及字段、主外键关系
- Prompt：
  > 请分析 daloradius 现有数据库 schema 和相关 PHP 代码，输出所有表结构说明及 ER 图。

### 2.2 设计 Python ORM 数据模型
- 输入：数据库表结构说明、选定 ORM 框架（如 SQLAlchemy/Django ORM）
- 输出：ORM 数据模型代码、模型说明文档
- 要求：字段类型、关系映射准确
- Prompt：
  > 请根据数据库表结构说明，使用选定 ORM 框架编写 Python 数据模型代码，并输出模型说明文档。

### 2.3 编写数据库迁移脚本
- 输入：ORM 数据模型、现有数据库数据
- 输出：迁移脚本（如 Alembic、Django migration）、迁移说明文档
- 要求：支持数据迁移、结构变更
- Prompt：
  > 请根据 Python ORM 数据模型和现有数据库数据，编写数据库迁移脚本，并输出迁移说明文档。

---

## 3. 认证与授权模块重构
### 3.1 用户认证逻辑重写
- 输入：原认证相关 PHP 代码、功能说明
- 输出：Python 认证模块代码、接口文档
- 要求：安全性高，支持主流认证方式
- Prompt：
  > 请参考原 daloradius 认证相关 PHP 代码，使用 Python 重写认证模块，并输出接口文档。

### 3.2 权限管理与角色分配实现
- 输入：原权限相关代码、角色需求说明
- 输出：Python 权限管理模块代码、角色分配说明
- 要求：支持多角色、细粒度权限控制
- Prompt：
  > 请根据 daloradius 权限需求，使用 Python 实现权限管理与角色分配模块，并输出说明文档。

---

## 4. 计费与账单模块重构
### 4.1 账单生成逻辑重写
- 输入：原账单相关 PHP 代码、业务规则说明
- 输出：Python 账单生成模块代码、接口文档
- 要求：逻辑准确，支持多种计费方式
- Prompt：
  > 请参考 daloradius 原账单相关 PHP 代码和业务规则，使用 Python 重写账单生成逻辑，并输出接口文档。

### 4.2 支付接口集成
- 输入：支付需求说明、第三方支付 API 文档
- 输出：支付接口集成代码、集成说明
- 要求：安全合规，支持主流支付方式
- Prompt：
  > 请根据 daloradius 支付需求和第三方支付 API 文档，集成支付接口并输出集成说明。

### 4.3 账单历史与报表功能实现
- 输入：原账单历史相关代码、报表需求说明
- 输出：Python 报表模块代码、报表样例
- 要求：支持多维度查询与导出
- Prompt：
  > 请根据 daloradius 账单历史和报表需求，使用 Python 实现账单历史与报表功能，并输出报表样例。

---

## 5. 运营与运维功能重构
### 5.1 运维相关功能（如备份、日志、配置）重写
- 输入：原运维相关 PHP 代码、功能说明
- 输出：Python 运维模块代码、操作文档
- 要求：功能完整，易于自动化
- Prompt：
  > 请参考 daloradius 原运维相关 PHP 代码，使用 Python 重写备份、日志、配置等运维功能，并输出操作文档。

### 5.2 运营报表与统计功能重写
- 输入：原运营报表相关代码、统计需求说明
- 输出：Python 统计模块代码、报表样例
- 要求：支持多维度统计与可视化
- Prompt：
  > 请根据 daloradius 运营报表和统计需求，使用 Python 实现运营报表与统计功能，并输出报表样例。

---

## 6. 用户管理与自服务模块重构
### 6.1 用户信息管理功能重写
- 输入：原用户管理相关 PHP 代码、功能说明
- 输出：Python 用户管理模块代码、接口文档
- 要求：支持用户增删改查、批量操作
- Prompt：
  > 请参考 daloradius 原用户管理相关 PHP 代码，使用 Python 重写用户信息管理功能，并输出接口文档。

### 6.2 用户自服务界面重写
- 输入：原自服务相关代码、界面需求说明
- 输出：Python 自服务界面代码、界面说明
- 要求：界面友好，功能完整
- Prompt：
  > 请根据 daloradius 用户自服务需求，使用 Python 重写自服务界面，并输出界面说明。

---

## 7. 前端界面重构
### 7.1 设计并实现新的前端界面
- 输入：原前端页面、UI/UX 设计稿
- 输出：新前端代码（Vue/React/Bootstrap）、界面说明
- 要求：美观易用，兼容主流浏览器
- Prompt：
  > 请参考 daloradius 原前端页面和 UI/UX 设计稿，使用 Vue/React/Bootstrap 设计并实现新的前端界面，并输出界面说明。

### 7.2 与后端 API 对接
- 输入：后端 API 文档、前端代码
- 输出：前后端对接代码、接口调用说明
- 要求：接口调用规范，数据交互准确
- Prompt：
  > 请根据后端 API 文档和前端代码，实现前后端对接，并输出接口调用说明。

---

## 8. API 设计与实现
### 8.1 设计 RESTful API 接口文档
- 输入：功能清单、业务流程说明
- 输出：API 接口文档（OpenAPI/Swagger）
- 要求：接口规范，覆盖所有业务功能
- Prompt：
  > 请根据 daloradius 功能清单和业务流程，设计 RESTful API 接口文档，推荐使用 OpenAPI/Swagger 格式。

### 8.2 实现 API 并编写测试用例
- 输入：API 接口文档、后端代码
- 输出：API 实现代码、测试用例
- 要求：接口实现与文档一致，测试覆盖率高
- Prompt：
  > 请根据 API 接口文档，实现所有 API 并编写测试用例，确保接口实现与文档一致。

---

## 9. 测试与质量保障
### 9.1 编写单元测试与集成测试
- 输入：后端/前端代码、功能说明
- 输出：测试代码、测试报告
- 要求：覆盖主要功能，自动化执行
- Prompt：
  > 请根据 daloradius 各模块代码和功能说明，编写单元测试与集成测试，并输出测试报告。

### 9.2 自动化测试脚本与 CI/CD 集成
- 输入：测试代码、CI/CD 平台说明
- 输出：自动化测试脚本、CI/CD 配置文件
- 要求：自动化执行，集成主流平台（如 GitHub Actions）
- Prompt：
  > 请根据测试代码和 CI/CD 平台说明，编写自动化测试脚本并集成到 CI/CD 流程。

---

## 10. 部署与文档
### 10.1 编写部署脚本与 Dockerfile
- 输入：项目代码、部署需求说明
- 输出：部署脚本、Dockerfile、部署说明文档
- 要求：支持一键部署，兼容主流环境
- Prompt：
  > 请根据 daloradius 项目代码和部署需求，编写部署脚本与 Dockerfile，并输出部署说明文档。

### 10.2 完善开发、运维、用户文档
- 输入：项目代码、各模块说明
- 输出：开发文档、运维文档、用户手册
- 要求：内容详实，便于查阅
- Prompt：
  > 请根据 daloradius 项目代码和各模块说明，完善开发、运维、用户文档，内容需详实易懂。

---

如需进一步细化某个任务或生成具体执行清单，请补充说明。
